
this document gives you a line by line description of what's required to setup and run an election using code.vote and belenios underlying cryptographic protocol

# Root

Please ask us to create a server instance for you

# Administrator

0. login to your code.vote server with your userid and password

    $ SSH AdminUserID@code.vote
    AdminUserID@code.vote's password:
    
### setting up the election 

1. Generate an UUID with the `uuidgen` command.

        $ uuidgen
         4f112241-8b3c-4b6b-8995-9c224c44867d
    

2. Edit `questions.json`

3. create the **bulletin board**
`belenios-tool mkelection --uuid $UUID --group default.json --template questions.json`
to generate `election.json`

4. Publish `$UUID` on the bulletin board and notify the **trustees** and the **census**

### Tallying the election

 1. check  `election.json`,`public_keys.jsons`, `public_creds.txt` and `ballots.jsons`files
 2. Concatenate the `partial_decryption.json` received from each trustee into a `partial_decryptions.jsons`, in the same order as in
    `public_keys.jsons`.
 3. Run `belenios-tool finalize`.  It will create
    `result.json`. 
Publish this file on the **bulletin board**, along with the files listed in the first step above. The whole set will enable universal
    verifiability.

Note: `partial_decryptions.jsons` is a temporary file whose contents is embedded in `result.json`, so it can be discarded.

## Trustee's guide

0. login to your code.vote server with your userid and password

    $ SSH TrusteeID@code.vote
    TrusteeID@code.vote's password:

### crete your trustee keys

1. Generate a trustee keypair with the command line :

    belenios-tool trustee-keygen

It will generate two files, `XXXXXXXX.public` and `XXXXXXXX.private`, containing respectively the public and the private key.

2. keep the private key with extreme care 
3. publish the public key file to THE **bulletin board**.
4. When the election is open, you must check that your public key is present in the published `public_keys.jsons`.

### Decrypt the results

To compute your decryption share, run:

    belenios-tool decrypt --privkey /path/to/privkey > XXXXXXXX_decryption.json

Publish `XXXXXXXX_decryption.json` to the **bulletin board**.

Note: be sure to authenticate all your input files when you use your private key!

## census

0. login to your code.vote server with your userid and password

    $ SSH CensusID@code.vote
    CensusID@code.vote's password:

### voting keys generation

If you have a list of voters in a file `F` with `N` lines, one voter identifier per line, run:

    belenios-tool credgen --uuid XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX --file F

where `XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX` is the $UUID of the election generated by the administrator. 

It will generate three files with `N` lines:

 * `T.privcreds`: each line of this file contains the voter identifier and a private voting key. Keep this file secret, and secure if you want to be able to re-send a voting key later (e.g. if a voter lost or did not receive it).

 * `T.pubcreds`: each line of this file contains the public voting keys.

 * `T.hashcreds`: each line of this file contains, for each identifier in
   `T.privcreds`, the hash of the corresponding public key.

1. Destroy `T.hashcreds`
2. publish `T.pubcreds`as `public_creds.txt` to the **bulletin board**
3. distribute to each voter the private voting key corresponding to her identifier as per `T.privcreds`

## bulletin board

there is no human user associated with the bulletin board which simply records all the files guaranteeing the integrity of the voting system, and beyond, the election. The algorithm is as follows :

For each received ballot, append it to `ballots.jsons` and run:

    belenios-tool verify 

If no error is reported, publish the new `ballots.jsons`; otherwise,
the new ballot is incorrect and revert `ballots.jsons` to its
previous state.

Note that each ballot must be authenticated in order to prevent the **census** from stuffing the ballot box.

_____________________

## Auditor

**ANYONE** can be an auditor. Everyone who aims to play a role
in an election should start by auditing the election data.

During an election, anybody has read only access to the following files:

 * `election.json`: election parameters
 * `public_keys.jsons`: trustees' public keys
 * `public_creds.txt`: the public keys associated to valid credentials
 * `ballots.jsons`: accepted ballots

Note that the last one is dynamic, and evolve during the election. At
the end of the election, it is frozen and a `result.json` file will be
published.

simply run the following command

    belenios-tool verify


